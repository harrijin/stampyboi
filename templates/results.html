<html>
  <head>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/results.css') }}">
  </head>
  <body>

    <div>
    <form action='/' id="home">
      <button><img src="/static/images/logo.png" alt="Stampyboi"></button>
    </form>
    </div>
    <form action='/results' method='POST' autocomplete="off" id="newSearch">
        <div class="group">
                <input type="text" id="quote" name="quote" oninput="suggest()" list="autosuggest" value="{{query}}" placeholder="Streets ahead!">
                <span class="bar" name="quoteTop"></span>
                <span class="bar" name="quote"></span>
                <span class="vertBar" name="left"></span>
                <span class="vertBar" name="right"></span>
        </div>
        <input type='submit' value="Search">
    </form>
    <div id='spellchecking' class="select">

    </div>

    <div>
    {% if result is not string %}
        {% for doc in result %}
            {% set id = doc['id'] %}
            {% set info = doc|tojson %}
            <div id="{{id}}" class="{{doc['type'] ~ ' result'}}">
                <div class="typetab"></div>
                {% if doc['type'] == 'yt' %}
                    <a class="title link" href='javascript:;' onclick='directToVideo({{info}}, "0")'>{{doc['title']}}</a>
                    <p class="info">{{doc['channel']}} • {{doc['date']}}</p>
                    <div id="wrap-timestamps">
                        <a class="thumbnail" href='javascript:;' onclick='directToVideo({{info}}, "0")'>
                            <img src="{{doc['thumb']}}" width=320 height=180 alt="thumbnail">
                        </a>
                        <div class="result-timestamps">
                        <table id="times" cellspacing="0px" cellpadding="0px">
                            {% for tuple in doc['list'] %}
                                {% set text = tuple[0] %}
                                {% set sec = tuple[1] %}

                                <tr onclick='directToVideo({{info}}, "{{loop.index0}}")'>
                                    <td>{{text}}</td>
                                    <td class="timestamp">{{time_string(sec)}}</td>
                                </tr>

                            {% endfor %}
                        </table>
                        </div>
                    </div>
                {% else %}
                    {% set extension, is_video = get_extension(id) %}
                    <a class="title link" href='javascript:;' onclick='directToVideo({{info}}, "0")'>{{id}}</a>
                    <p class="info">{{time_string(doc['length'])}} • {{extension.upper()}} File</p>
                    <div id="wrap-timestamps">
                        {% if is_video %}
                        <a class="thumbnail" href='javascript:;' onclick='directToVideo({{info}}, "0")'>
                            <video src="{{ url_for('download_file', filename=id) }}#t=0,0" width="320" height="180" style="background-color: black;"></video>
                        </a>
                        {% endif %}
                        <div class="result-timestamps">
                        <table id="times" cellspacing="0px" cellpadding="0px">
                            {% for tuple in doc['list'] %}
                                {% set text = tuple[0] %}
                                {% set sec = tuple[1] %}

                                <tr onclick='directToVideo({{info}}, "{{loop.index0}}")'>
                                    <td>{{text}}</td>
                                    <td class="timestamp">{{time_string(sec)}}</td>
                                </tr>

                            {% endfor %}
                        </table>
                        </div>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        {{result}}
    {% endif %}
    </div>
    <script src="http://www.youtube.com/player_api"></script>
    <script>
        // This script needs to be here so the overlay can reference it
        var apiReady = false;
        function onYouTubeIframeAPIReady() {
            apiReady = true;
            console.log('api ready');
        }
    </script>
    <!-- THIS IS WHERE THE VIDEO OVERLAY WILL GO -->
  </body>

    <script src="https://unpkg.com/json5@^2.0.0/dist/index.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="{{url_for('static', filename='results.js')}}"></script>
    <script>
        check_spelling();
        function suggest(){
            var userIn=encodeURIComponent(document.getElementById('quote').value);
            var suggestRequest = new XMLHttpRequest();
            suggestRequest.open('POST','/suggest', true);
            suggestRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            suggestRequest.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var suggestions = JSON5.parse(this.responseText);
                    $( "#quote" ).autocomplete({
                        source: suggestions
                    });
                }

            };
            suggestRequest.send("q="+userIn);

        }
    </script>
</html>


