<div class="overlay">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/video.css') }}">
    <!-- <div>
        <form action='/'>
            <input type='submit' value='New search'>
        </form>
    </div> -->
    
    <div class="vertically-center">
        <div class="clip-container">
        {% if doc is not none %}
            {% set start = doc['list'][stamp][1] %}
            <iframe id="player" width="100%" height="100%" src="{{'https://www.youtube.com/embed/' ~ doc['id'] ~ '?autoplay=1&enablejsapi=true&start=' ~ start}}" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            <div class="infobar">
                <div class="ytInfo">
                    <h1>{{doc['title']}}</h1>
                    <h4>{{doc['channel']}} â€¢ {{doc['date']}}</h4>
                </div>
                <div class="timestamps">
                <table id="times" cellspacing="0px" cellpadding="0px">
                    {% for tuple in doc['list'] %}
                        {% set text = tuple[0] %}
                        {% set sec = tuple[1] %}

                        {% if sec == start %}
                        <tr onclick="setActive(this);seek('{{sec}}');" class="activeStamp">
                        {% else %}
                        <tr onclick="setActive(this);seek('{{sec}}');">
                        {% endif %}
                            <td>{{text}}</td>
                            <td class="timestamp">{{time_string(sec)}}</td>
                        </tr>

                    {% endfor %}
                </table>
                </div>
            </div>
        {% else %}
            <p>ERROR: No video.</p>
        {% endif %}
        </div>

        <div id="share">
            <h2>Share this boi:</h2>
            <div id="share-buttons">
                    <!-- Facebook -->
                <a href='javascript:;' onclick='shareBoi(1)'>
                    <img src="https://simplesharebuttons.com/images/somacro/facebook.png" alt="Facebook"/>
                </a>
                    <!-- Twitter -->
                <a href='javascript:;' onclick='shareBoi(2)'>
                    <img src="https://simplesharebuttons.com/images/somacro/twitter.png" alt="Twitter" />
                </a>
                    <!-- Reddit -->
                <a href='javascript:;' onclick='shareBoi(3)'>
                    <img src="https://simplesharebuttons.com/images/somacro/reddit.png" alt="Reddit" />
                </a>
                    <!-- Link (copy) -->
                <a href='javascript:;' onclick='shareBoi(4)'>
                    <img src="/static/images/link.png" alt="Get link" />
                </a>
            </div>
        </div>

    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var player;
        if (apiReady) {
            new YT.Player('player', {
                events: {
                    'onReady': onPlayerReady
                }
            });
        }

        function onPlayerReady(event) {
            player = event.target;
            player.playVideo();
            console.log('player ready');
        }

        function seek(sec) {
            if (player) {
                player.seekTo(parseInt(sec), true);
            }
        }

        // https://stackoverflow.com/questions/1403615/use-jquery-to-hide-a-div-when-the-user-clicks-outside-of-it
        $(document).mouseup(function(e) {
            var container = $(".clip-container");
            var share = $("#share");

            // if the target of the click isn't the container nor a descendant of the container
            if (!container.is(e.target) && container.has(e.target).length === 0
                && !share.is(e.target) && share.has(e.target).length === 0) {
                
                $('body').css('overflow', 'auto');
                $('.overlay').remove();
            }
        });

        function setActive(el) {
            $('.activeStamp').removeClass('activeStamp');
            $(el).addClass('activeStamp');
        }

        function shareBoi(dest){
            //dest values
            //1 - facebook
            //2 - twitter
            //3 - reddit
            var a = $('.activeStamp .timestamp').html().split(':');
            var seconds = (+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]);
            var link = "https://youtu.be/{{doc['id']}}?t=" + seconds;
            if(dest < 3){
                link = encodeURIComponent(link);
            } else if(dest == 3){
                link = encodeURI(link);
            }
            console.log(link);
            switch(dest){
                case 1:
                    window.open("https://www.facebook.com/sharer.php?u="+link, "_blank");
                break;
                case 2:
                    window.open("https://twitter.com/intent/tweet?url="+link, "_blank");
                break;
                case 3:
                    window.open("https://www.reddit.com/submit?url="+link, "_blank");
                break;
                default:
                    var dummy = document.createElement("textarea");
                    document.body.appendChild(dummy);
                    dummy.textContent = link;
                    dummy.select();
                    document.execCommand("copy");
                    document.body.removeChild(dummy);
                    if(!$('#copied').length){
                        $('body').append("<p id='copied'>Link copied!</p>");
                    }else if($('#copied').css('display')=='none' || $('#copied').css('opacity') < 1){
                        $('#copied').css('display','inherit');
                        $('#copied').stop(true, true);
                        $('#copied').fadeTo(10, 1);
                    }
                    $('#copied').fadeOut(3000);
                break;
            }
        }
    </script>
</div>